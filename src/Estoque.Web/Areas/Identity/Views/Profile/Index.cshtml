@model PersonalInfoViewModel
@using Estoque.Lib.Resources
@using Microsoft.Extensions.Localization
@inject IStringLocalizer<EstoqueResources> Localizer
@{
    Layout = "~/Areas/Estoque/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Perfil";
    var defaultAvatar = Url.Content("~/img/default_profile.png");
}

<div class="container py-4">

    <!-- Avatar -->
    <div class="d-flex flex-column align-items-center mb-4">
        <form enctype="multipart/form-data" id="profile-picture-form" method="post"
              asp-action="SaveProfilePicture" asp-controller="Profile" asp-area="Identity">
            @Html.AntiForgeryToken()
            <div class="position-relative" style="width: 140px; cursor:pointer;"
                 onclick="document.getElementById('newProfilePicture').click();">
                <input type="file" id="newProfilePicture" name="newProfilePicture" class="d-none" accept="image/*"
                       onchange="previewAndUpload(this)" />
                <img id="avatarPreview" src="@Model.AvatarUrl"
                     onerror="this.onerror=null;this.src='@defaultAvatar';"
                     class="rounded-circle border border-2 avatar-hover"
                     style="width: 140px; height: 140px; object-fit: cover;" alt="@Localizer["Avatar"]" />
            </div>
        </form>
        <h4 class="mt-3">@Model.FirstName @Model.LastName</h4>
        <p class="text-muted mb-0">@Model.Email</p>
    </div>

    <!-- Formulário de informações pessoais -->
    <div class="card mx-auto" style="max-width: 600px;">
        <div class="card-body">
            <h5 class="text-primary mb-3">@Localizer["InformacoesPessoais"]</h5>
            <form id="personal-information-form" method="post"
                  asp-action="SavePersonalInformation" asp-controller="Profile" asp-area="Identity">
                @Html.AntiForgeryToken()

                <div class="mb-3 form-floating">
                    <input class="form-control" type="text" id="firstName" name="firstName"
                           placeholder="@Localizer["Nome"]" value="@Model.FirstName" />
                    <label for="firstName">@Localizer["Nome"]</label>
                </div>

                <div class="mb-3 form-floating">
                    <input class="form-control" type="text" id="lastName" name="lastName"
                           placeholder="@Localizer["Sobrenome"]" value="@Model.LastName" />
                    <label for="lastName">@Localizer["Sobrenome"]</label>
                </div>

                <div class="d-flex justify-content-between">
                    <button type="submit" class="btn btn-primary">@Localizer["Save"]</button>
                    <a href="@Url.Action("Index", "Home", new { area = "Estoque" })" class="btn btn-secondary">@Localizer["Cancel"]</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Feedback de Sucesso -->
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show mt-3 text-center mx-auto" role="alert" style="max-width: 600px;">
            <i class="fa-regular fa-circle-check me-2"></i>
            @TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

</div>

<script>
    window.profilePictureUrl = '@Url.Action("SaveProfilePicture", "Profile", new { area = "Identity" })';
</script>
<script src="~/js/profile.js" asp-append-version="true"></script>
<link rel="stylesheet" href="~/css/profile.css" asp-append-version="true" />
