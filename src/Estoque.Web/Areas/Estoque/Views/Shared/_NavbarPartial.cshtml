@inject IHttpContextAccessor HttpContextAccessor
@using Estoque.Lib.Resources
@using Microsoft.Extensions.Localization
@inject IStringLocalizer<EstoqueResources> Localizer
@{
    var userId = HttpContextAccessor!.HttpContext?.User.FindFirst("sub")?.Value
                 ?? HttpContextAccessor.HttpContext?.User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value;
    var avatarUrl = userId != null
        ? Url.Action("Avatar", "Profile", new { area = "Identity", userId })
        : Url.Content("~/img/default_profile.png");

    var currentCulture = System.Globalization.CultureInfo.CurrentUICulture.Name;
    var dataAtual = DateTime.Now.ToString("MMMM, yyyy", System.Globalization.CultureInfo.CurrentCulture);

}

<nav class="navbar navbar-top fixed-top navbar-expand shadow-sm" id="navbarDefault">
    <div class="container-fluid">
        <!-- Esquerda: Logo e hambúrguer -->
        <div class="d-flex align-items-center">
            <button class="btn navbar-toggler d-lg-none me-2" type="button"
                    data-bs-toggle="collapse" data-bs-target="#navbarVerticalCollapse"
                    aria-controls="navbarVerticalCollapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a class="navbar-logo d-flex align-items-center" href="@Url.Action("Index", "Home", new { area = "Estoque" })">
                <img src="~/img/logo.png" alt="Logo" width="50" height="50" class="me-2" />
                <span class="fw-bold">Vip Penha</span>
            </a>
        </div>

        <!-- Direita: Ações -->
        <ul class="navbar-nav navbar-nav-icons flex-row align-items-center">
            <li class="nav-item">
            <div class="d-flex align-items-center me-3">
                <button class="btn navbar-toggler d-lg-none me-2" type="button"
                        data-bs-toggle="collapse" data-bs-target="#navbarVerticalCollapse"
                        aria-controls="navbarVerticalCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                    <span class="fw-semibold text-muted" style="color: #969db2 !important;">@dataAtual</span>
            </div>
            </li>

            <!-- Tema -->
            <li class="nav-item">
                <div class="theme-control-toggle position-relative">
                    <input class="form-check-input ms-0 theme-control-toggle-input" type="checkbox"
                           data-theme-control="phoenixTheme" value="dark" id="themeControlToggle" hidden/>
                    <label class="mb-0 theme-control-toggle-label" for="themeControlToggle"
                           data-bs-toggle="tooltip" data-bs-placement="bottom" title="Mudar Tema">
                        <span id="themeIcon" class="bi bi-sun-fill"></span>
                    </label>
                </div>
            </li>

            <li class="nav-item dropdown hide-on-xs">
                <button id="language-button" data-bs-placement="bottom" title="Idioma" type="button" class="nav-link"
                        aria-expanded="false" data-bs-toggle="dropdown">
                    <span class="fas fa-lg fa-globe-americas" style="color: #969db2;"></span>
                </button>
                <ul class="dropdown-menu dropdown-menu-end navbar-dropdown-caret" href="#">
                    <li>
                        <form method="post" asp-area="Admin" asp-controller="Language" asp-action="SetLanguage" class="m-0 p-0">
                            <input type="hidden" name="returnUrl" value="@(Context.Request.Path + Context.Request.QueryString)" />
                            <button type="submit" class="dropdown-item @(currentCulture == "en-US" ? "active" : "")"
                                    name="culture" value="en-US">
                                <span class="fi fi-us"></span><span>&nbsp;United States</span>
                            </button>
                        </form>
                    </li>
                    <li>
                        <form method="post" asp-area="Admin" asp-controller="Language" asp-action="SetLanguage" class="m-0 p-0">
                            <input type="hidden" name="returnUrl" value="@(Context.Request.Path + Context.Request.QueryString)" />
                            <button type="submit" class="dropdown-item @(currentCulture == "pt-BR" ? "active" : "")"
                                    name="culture" value="pt-BR">
                                <span class="fi fi-br"></span><span>&nbsp;Brasil</span>
                            </button>
                        </form>
                    </li>
                </ul>
            </li>

            <ul class="navbar-nav align-items-center">

                <!-- Avatar + Nome -->
                <li class="nav-item dropdown d-flex align-items-center me-3">
                    <a class="nav-link lh-1 d-flex align-items-center" id="navbarDropdownUser" href="#"
                       data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="Menu do Usuário">
                        <div class="avatar avatar-l position-relative me-2">
                            <img src="@avatarUrl"
                                 onerror="this.onerror=null;this.src='@Url.Content("~/img/default_profile.png")';"
                                 class="rounded-circle" alt="Avatar" />
                        </div>
                        <span class="d-none d-md-inline" style="color:#969db2;">
                            @User.FindFirst("FirstName")?.Value @User.FindFirst("LastName")?.Value
                        </span>
                    </a>

                    <!-- Dropdown do usuário -->
                    <div class="dropdown-menu dropdown-menu-end navbar-dropdown-caret py-0 dropdown-profile shadow border"
                         aria-labelledby="navbarDropdownUser" style="min-width: 16rem; max-height: 24rem; overflow: visible;">
                        <div class="card position-relative border-0">
                            <div class="card-body p-0">
                                <br />
                            </div>
                            <div class="overflow-auto scrollbar" style="max-height: 20rem;">
                                <ul class="nav flex-column mb-2 pb-1">
                                    <li class="nav-item">
                                        <a class="nav-link px-3" asp-area="Identity"
                                           asp-controller="Profile" asp-action="Index">
                                            <span class="me-2 fa fa-user"></span>@Localizer["Perfil"]
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link px-3" href="/Identity/Email/ChangeEmail">
                                            <span class="me-2 fa fa-at"></span>@Localizer["AlterarEmail"]
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link px-3" href="/Identity/ChangePassword">
                                            <span class="me-2 fa fa-key"></span>@Localizer["AlterarSenha"]
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <div class="card-footer p-0 border-top border-translucent">
                                <div class="px-3 logout-button">
                                    <form id="logoutForm" asp-area="Identity" asp-controller="SignOut" asp-action="Index"
                                          method="post" class="w-100">
                                        @Html.AntiForgeryToken()
                                        <button type="submit" class="btn btn-secondary w-100 mt-2">
                                            <i class="fa fa-sign-out-alt me-2"></i>@Localizer["Leave"]
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </li>

                <!-- Barra vertical -->
                <li class="nav-item d-none d-md-flex align-items-center text-body-tertiary me-3">|</li>

                <!-- Notificações -->
                <li class="nav-item dropdown">
                    <a class="nav-link text-center position-relative" href="#" role="button"
                       data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                       data-bs-auto-close="outside">
                        <i class="bi bi-bell-fill" style="color: #969db2;"></i>
                    </a>
                    <div class="dropdown-menu dropdown-menu-end notification-dropdown-menu py-0 shadow border navbar-dropdown-caret"
                         style="max-width: 350px; word-wrap: break-word;">
                        <div class="card mb-0 position-relative border-0">
                            <div class="card-body p-0">
                                <div class="scrollbar-overlay" style="height: 27rem;" data-simplebar>
                                    <div class="simplebar-content mt-3" id="notificacoes-container">
                                        @await Html.PartialAsync(
                                        "~/Areas/Estoque/Views/Shared/_NotificacoesDropdown.cshtml",
                                                                                ViewBag.Notificacoes as List<Estoque.Domain.Entities.Notificacao> ?? []
                                                                                )
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer p-0 border-top border-translucent">
                                <div class="my-2 text-center fw-bold fs-10 text-body-tertiary text-opacity-85">
                                    <a class="fw-bolder" href="/Notifications">@Localizer["HistoricoNotificacoes"]</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
                <li class="nav-item me-2">
                    <a class="nav-link text-center" href="#" data-bs-toggle="modal" data-bs-target="#sobreEmpresaModal" title="Sobre a Empresa">
                        <i class="fas fa-info-circle" style="color: #969db2;"></i>
                    </a>
                </li>
            </ul>

        </ul>
    </div>
</nav>


<div class="modal fade" id="sobreEmpresaModal" tabindex="-1" aria-labelledby="sobreEmpresaModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header text-white">
                <h5 class="modal-title" id="sobreEmpresaModalLabel">Sobre</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
                <div class="text-center mb-4">
                    <img src="~/img/ifsp.png" alt="Logotipo IFSP" class="mb-3" style="width: 100px;">
                    <h4 class="text-primary">Uma Parceria de Inovação</h4>
                    <p class="text-muted">
                        Este produto foi desenvolvido como um projeto acadêmico pelo time de alunos do
                        <strong>Instituto Federal de Ciência e Tecnologia de São Paulo (IFSP)</strong>,
                        campus São Paulo. Uma prova de que a tecnologia e a educação andam juntas.
                    </p>
                </div>

                <hr>

                <div class="text-center mb-4">
                    <img src="~/img/logo.png" alt="Logotipo VIP Penha" class="mb-3" style="width: 100px;">
                    <h4 class="text-secondary">VIP Penha</h4>
                    <p>
                        A Vip Penha é especialista em <strong>acessórios para celular e assistência técnica</strong>.
                        Atua com vendas no atacado e varejo, oferecendo soluções completas e de alta qualidade para todos os clientes.
                    </p>
                </div>

                <hr>

                <div class="mt-4">
                    <h5 class="text-primary"><i class="bi bi-geo-alt-fill me-2"></i>Contatos do IFSP - Campus São Paulo</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <strong>Endereço:</strong> <a href="https://maps.app.goo.gl/seu-endereco" target="_blank" class="text-decoration-none">R. Pedro Vicente, 625 - Canindé, São Paulo - SP, 01109-010</a>
                        </li>
                        <li class="mb-2">
                            <strong>Telefone:</strong> <a href="tel:+551127637548" class="text-decoration-none">(11) 2763-7548</a>
                        </li>
                        <li class="mb-2">
                            <strong>Website:</strong> <a href="https://spo.ifsp.edu.br" target="_blank" class="text-decoration-none">spo.ifsp.edu.br</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>




