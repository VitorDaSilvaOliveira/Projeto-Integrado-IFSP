@using System.Security.Claims
@using Estoque.Domain.Entities
@using Estoque.Infrastructure.Utils
@using Microsoft.AspNetCore.Identity
@using Estoque.Lib.Resources
@using Microsoft.Extensions.Localization
@inject UserManager<ApplicationUser> UserManager
@inject IStringLocalizer<EstoqueResources> Localizer

@{
    // MUDANÇA: Novo Título da Página
    ViewBag.Title = Localizer["DashboardPedidos"];
}

@functions {
    // Mantemos a função de saudação inalterada
    private async Task<string> GetUserFirstName()
    {
        var userId = User.FindFirstValue(ClaimTypes.NameIdentifier);
        var user = await UserManager.FindByIdAsync(userId!);
        return user?.FirstName ?? Localizer["User"];
    }
}

@{
    var name = await GetUserFirstName();
    var hour = LocalTime.Now().Hour;

    var greeting = hour switch
    {
        >= 6 and < 12 => Localizer["GoodDay"],
        >= 12 and < 18 => Localizer["GoodAfternoon"],
        _ => Localizer["GoodNight"]
    };
}

<div class="container mt-5">
    <div class="row mb-4">
        <div class="col">
            <h2 class="text-primary">@greeting, @name.</h2>
        </div>
        <span class="fw-light overflow-hidden">
            @Localizer["Welcome"]
            <span class="typed-text fw-bold" data-typed-text='["Dashboard Pedidos", "@Localizer["LatestNews"]"]'></span>
        </span>
    </div>

    <div class="row">

        <div class="col-sm-12 mb-4">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="mb-3 text-center">@Localizer["OrdersByOperationTitle"]</h5>
                    <canvas id="operacaoChart"></canvas>
                </div>
            </div>
        </div>

        <div class="col-sm-6 mb-4">
            <div class="card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-center">
                        <div>
                            <h5 class="mb-3">@Localizer["OrdersByStatusTitle"]</h5>
                        </div>
                    </div>
                    <div class="d-flex justify-content-center p-1">
                        <canvas id="statusChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-sm-6 mb-4">
            <div class="card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-center">
                        <div>
                            <h5 class="mb-3">@Localizer["MonthlyRevenueEvolutionTitle"]</h5>
                        </div>
                    </div>
                    <div class="d-flex justify-content-center p-1">
                        <canvas id="faturamentoMensalChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // MUDANÇA: Adicionando novos rótulos de tradução para os gráficos
    const textTranslated = {
        // Rótulos usados no gráfico central (Operação)
        sales: "@Localizer["Sales"]", // Ex: "Vendas"
        exchanges: "@Localizer["Exchanges"]", // Ex: "Trocas"

        // Rótulo usado no gráfico de Linha (Faturamento)
        totalRevenue: "@Localizer["TotalRevenue"]", // Ex: "Faturamento Total"

        // Rótulos de unidades
        orders: "@Localizer["Pedidos"]", // Ex: "Pedidos"
        currency: "@Localizer["Currency"]" // Ex: "R$" ou "Moeda"
    };
</script>

<script src="~/js/dashboardpedidos.js" asp-append-version="true"></script>

